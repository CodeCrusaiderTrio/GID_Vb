function onApplePayButtonClicked(){if(document.getElementById("pmethod").value="25",!check_fields("/payment/"))return!1;var e=new ApplePaySession(12,getApplePayTransactionInfo());e.begin(),e.onvalidatemerchant=function(t){var n=t.validationURL;validateSession(n,function(t){e.completeMerchantValidation(t)})},e.onpaymentauthorized=function(t){var n=t.payment.token;pay(n,function(t){t?(e.completePayment({status:e.STATUS_SUCCESS}),document.getElementById("apay").value=encodeURIComponent(JSON.stringify(t)),document.getElementById("pmethod").value=25,document.getElementById("pt0").style.display="none",document.getElementById("pt1").style.display="none",document.getElementById("pt16").style.display="none",document.getElementById("outcome").style.display="none",document.getElementById("outcome").innerHTML="",document.getElementById("ajaxloader").style.display="inline-block",document.getElementById("surcharge_text").style.display="none",pcs_retrieve_post("/misc/insert_new_order.php","checkout")):e.completePayment({status:e.STATUS_FAILURE})})}}let MECHAT_ID="merchant.pcspecialist",PCS_URL="/misc/applepay_outcome.php";var appleButton=document.getElementById("applepay");window.ApplePaySession&&ApplePaySession.canMakePaymentsWithActiveCard(MECHAT_ID)&&(appleButton.style.display="block",appleButton.addEventListener("click",onApplePayButtonClicked),document.getElementById("payment-divider").style.display="inline-block");var validateSession=function(e,t){fetch(PCS_URL,{method:"POST",body:JSON.stringify({validationUrl:e}),headers:{"Content-Type":"application/json","Access-Control-allow-origin":"*"}}).then(e=>e.json()).then(e=>{t(e)}).catch(e=>{alert(`Error in validating merchant: ${e}`)})},pay=function(e,t){fetch(PCS_URL,{method:"POST",body:JSON.stringify({token_data:{version:e.paymentData.version,data:e.paymentData.data,signature:e.paymentData.signature,header:{ephemeralPublicKey:e.paymentData.header.ephemeralPublicKey,publicKeyHash:e.paymentData.header.publicKeyHash,transactionId:e.paymentData.header.transactionId}}}),headers:{"Content-Type":"application/json","Access-Control-allow-origin":"*"}}).then(e=>e.json()).then(e=>{t(e)}).catch(e=>{alert(`Error in payment: ${e}`)})};